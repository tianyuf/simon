{% extends "base.html" %}

{% block title %}Archive Browser - Herbert Simon Papers{% endblock %}

{% block content %}
<div style="max-width: 1000px; margin: 0 auto;">
    <p style="margin-bottom: 20px;">
        <a href="{{ url_prefix }}/" style="color: var(--primary); text-decoration: none;">← Back to search</a>
    </p>

    <h1 style="font-size: 1.8rem; margin-bottom: 10px;">Archive Structure</h1>
    <p style="color: var(--text-muted); margin-bottom: 30px;">
        Browse Herbert Simon's papers as they are organized in the physical archive at CMU.
        Click on a box to see its folders, or click folder counts to view documents.
        <a href="{{ url_prefix }}/missing" style="color: var(--primary);">View items not yet digitized &rarr;</a>
    </p>

    <div class="archive-grid">
        {% for box_num, info in structure|dictsort %}
        <div class="archive-box">
            <div class="box-header">
                <div class="box-header-text">
                    <h2>Box {{ box_num }}</h2>
                    {% if box_titles.get(box_num) %}
                    <div class="box-title-text">{{ box_titles[box_num].title }}</div>
                    {% endif %}
                </div>
                <div class="box-count-area">
                    <span class="box-count">{{ info.total }} items</span>
                    {% if box_titles.get(box_num) and box_titles[box_num].missing_folders > 0 %}
                    <span class="box-missing-label">Missing files</span>
                    {% endif %}
                </div>
            </div>
            <div class="folder-list">
                {% for folder_num, count in info.folders|dictsort %}
                <div class="folder-item-wrapper">
                    <a href="{{ url_prefix }}/?box={{ box_num }}&folder={{ folder_num }}&sort=archive_order&order=ASC" class="folder-item">
                        <span class="folder-name">Folder {{ folder_num }}</span>
                        <span class="folder-count">{{ count }}</span>
                    </a>
                    {% set folder_key = (box_num, folder_num) %}
                    {% if folder_descriptions.get(folder_key) %}
                    <div class="folder-description">{{ folder_descriptions[folder_key] | folder_label }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            <a href="{{ url_prefix }}/?box={{ box_num }}&sort=archive_order&order=ASC" class="view-all-link">
                View all {{ info.total }} items in Box {{ box_num }} →
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .archive-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .archive-box {
        background: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .box-header {
        background: var(--primary);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
    }

    .box-header-text {
        flex: 1;
        min-width: 0;
    }

    .box-header h2 {
        font-size: 1.1rem;
        margin: 0;
        line-height: 1.3;
    }

    .box-title-text {
        font-weight: 400;
        font-size: 0.85rem;
        opacity: 0.8;
        margin-top: 2px;
    }

    .box-count-area {
        text-align: right;
        white-space: nowrap;
    }

    .box-count {
        font-size: 0.85rem;
        opacity: 0.9;
        display: block;
    }

    .box-missing-label {
        display: inline-block;
        font-size: 0.7rem;
        background: rgba(255,255,255,0.2);
        padding: 1px 7px;
        border-radius: 3px;
        margin-top: 4px;
        opacity: 0.85;
    }

    .folder-list {
        max-height: 300px;
        overflow-y: auto;
        padding: 10px;
    }

    .folder-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 10px;
        text-decoration: none;
        color: var(--text);
        border-radius: 4px;
        transition: background 0.2s;
    }

    .folder-item:hover {
        background: var(--bg);
    }

    .folder-name {
        font-size: 0.9rem;
    }

    .folder-count {
        font-size: 0.85rem;
        color: var(--text-muted);
        background: var(--bg);
        padding: 2px 8px;
        border-radius: 10px;
    }

    .view-all-link {
        display: block;
        text-align: center;
        padding: 12px;
        background: var(--bg);
        color: var(--primary);
        text-decoration: none;
        font-size: 0.9rem;
        border-top: 1px solid var(--border);
    }

    .view-all-link:hover {
        background: #e8e8e8;
    }

    .folder-item-wrapper {
        border-bottom: 1px solid var(--border);
    }

    .folder-item-wrapper:last-child {
        border-bottom: none;
    }

    .folder-description {
        padding: 4px 10px 8px 10px;
        font-size: 0.75rem;
        color: var(--text-muted);
        line-height: 1.4;
    }

</style>
{% endblock %}
